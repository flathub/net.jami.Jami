name: ffmpeg
buildsystem: autotools
config-opts:
  # Disable everything
  - --disable-everything
  - --enable-zlib
  - --enable-gpl
  - --enable-swscale
  - --enable-bsfs
  - --disable-filters
  - --disable-programs
  - --disable-postproc
  - --disable-protocols 
  - --enable-protocol=crypto 
  - --enable-protocol=file 
  - --enable-protocol=rtp 
  - --enable-protocol=srtp 
  - --enable-protocol=tcp 
  - --enable-protocol=udp 
  - --enable-protocol=unix 
  - --enable-protocol=pipe
  # Enable muxers/demuxers
  - --disable-demuxers 
  - --disable-muxers 
  - --enable-muxer=rtp 
  - --enable-muxer=g722 
  - --enable-muxer=g723_1 
  - --enable-muxer=g726 
  - --enable-muxer=g726le 
  - --enable-muxer=h263 
  - --enable-muxer=h264 
  - --enable-muxer=hevc 
  - --enable-muxer=matroska 
  - --enable-muxer=webm 
  - --enable-muxer=ogg 
  - --enable-muxer=pcm_s16be 
  - --enable-muxer=pcm_s16le 
  - --enable-muxer=wav 
  - --enable-demuxer=rtp 
  - --enable-demuxer=mjpeg 
  - --enable-demuxer=mjpeg_2000 
  - --enable-demuxer=mpegvideo 
  - --enable-demuxer=gif 
  - --enable-demuxer=image_jpeg_pipe 
  - --enable-demuxer=image_png_pipe 
  - --enable-demuxer=image_webp_pipe 
  - --enable-demuxer=matroska 
  - --enable-demuxer=m4v 
  - --enable-demuxer=mp3 
  - --enable-demuxer=ogg 
  - --enable-demuxer=flac 
  - --enable-demuxer=wav 
  - --enable-demuxer=ac3 
  - --enable-demuxer=g722 
  - --enable-demuxer=g723_1 
  - --enable-demuxer=g726 
  - --enable-demuxer=g726le 
  - --enable-demuxer=pcm_mulaw 
  - --enable-demuxer=pcm_alaw 
  - --enable-demuxer=pcm_s16be 
  - --enable-demuxer=pcm_s16le 
  - --enable-demuxer=h263 
  - --enable-demuxer=h264 
  - --enable-demuxer=hevc
  # Enable parsers
  - --enable-parser=h263 
  - --enable-parser=h264 
  - --enable-parser=hevc 
  - --enable-parser=mpeg4video 
  - --enable-parser=vp8 
  - --enable-parser=vp9 
  - --enable-parser=opus
  # Encoders/decoders
  - --enable-encoder=adpcm_g722 
  - --enable-decoder=adpcm_g722 
  - --enable-encoder=adpcm_g726 
  - --enable-decoder=adpcm_g726 
  - --enable-encoder=adpcm_g726le 
  - --enable-decoder=adpcm_g726le 
  - --enable-decoder=g729 
  - --enable-encoder=g723_1 
  - --enable-decoder=g723_1 
  - --enable-encoder=rawvideo 
  - --enable-decoder=rawvideo 
  - --enable-encoder=libx264 
  - --enable-decoder=h264 
  - --enable-encoder=pcm_alaw 
  - --enable-decoder=pcm_alaw 
  - --enable-encoder=pcm_mulaw 
  - --enable-decoder=pcm_mulaw 
  - --enable-encoder=mpeg4 
  - --enable-decoder=mpeg4 
  - --enable-encoder=libvpx_vp8 
  - --enable-decoder=vp8 
  - --enable-decoder=vp9 
  - --enable-encoder=h263 
  - --enable-encoder=h263p 
  - --enable-decoder=h263 
  - --enable-encoder=mjpeg 
  - --enable-decoder=mjpeg 
  - --enable-decoder=mjpegb 
  - --enable-libspeex 
  - --enable-libopus 
  - --enable-libvpx 
  - --enable-libx264 
  - --enable-encoder=libspeex 
  - --enable-decoder=libspeex 
  - --enable-encoder=libopus 
  - --enable-decoder=libopus
  # Decoders for ringtones and audio streaming
  - --enable-decoder=flac 
  - --enable-decoder=vorbis 
  - --enable-decoder=aac 
  - --enable-decoder=ac3 
  - --enable-decoder=eac3 
  - --enable-decoder=mp3 
  - --enable-decoder=pcm_u24le 
  - --enable-decoder=pcm_u32le 
  - --enable-decoder=pcm_u8 
  - --enable-decoder=pcm_f16le 
  - --enable-decoder=pcm_f32le 
  - --enable-decoder=pcm_f64le 
  - --enable-decoder=pcm_s16le 
  - --enable-decoder=pcm_s24le 
  - --enable-decoder=pcm_s32le 
  - --enable-decoder=pcm_s64le 
  - --enable-decoder=pcm_u16le 
  - --enable-encoder=pcm_u8 
  - --enable-encoder=pcm_f32le 
  - --enable-encoder=pcm_f64le 
  - --enable-encoder=pcm_s16le 
  - --enable-encoder=pcm_s32le 
  - --enable-encoder=pcm_s64le
  # Encoders/decoders for images
  - --enable-encoder=gif 
  - --enable-decoder=gif 
  - --enable-encoder=jpegls 
  - --enable-decoder=jpegls 
  - --enable-encoder=ljpeg 
  - --enable-decoder=jpeg2000 
  - --enable-encoder=png 
  - --enable-decoder=png 
  - --enable-encoder=bmp 
  - --enable-decoder=bmp 
  - --enable-encoder=tiff 
  - --enable-decoder=tiff
  # Filters
  - --enable-filter=scale 
  - --enable-filter=overlay 
  - --enable-filter=amix 
  - --enable-filter=amerge 
  - --enable-filter=aresample 
  - --enable-filter=format 
  - --enable-filter=aformat 
  - --enable-filter=fps 
  - --enable-filter=transpose 
  - --enable-filter=pad
  # Decoders for ringtones and audio streaming
  - --enable-decoder=pcm_s16be 
  - --enable-decoder=pcm_s16be_planar 
  - --enable-decoder=pcm_s16le_planar 
  - --enable-decoder=pcm_s24be 
  - --enable-decoder=pcm_s24le_planar 
  - --enable-decoder=pcm_s32be 
  - --enable-decoder=pcm_s32le_planar 
  - --enable-decoder=pcm_s64be 
  - --enable-decoder=pcm_s8 
  - --enable-decoder=pcm_s8_planar 
  - --enable-decoder=pcm_u16be
  # Filters
  - --enable-filter=afir 
  - --enable-filter=split 
  - --enable-filter=drawbox 
  - --enable-filter=drawtext 
  - --enable-filter=rotate 
  - --enable-filter=loop 
  - --enable-filter=setpts 
  - --enable-filter=movie 
  - --enable-filter=alphamerge 
  - --enable-filter=boxblur 
  - --enable-filter=lut 
  - --enable-filter=negate 
  - --enable-filter=colorkey 
  - --enable-filter=transpose
  # Linux specific options
  - --enable-pic
  - --target-os=linux 
  - --enable-indev=v4l2 
  - --enable-indev=xcbgrab 
  - --enable-vdpau 
  - --enable-hwaccel=h264_vdpau 
  - --enable-hwaccel=mpeg4_vdpau 
  - --enable-vaapi 
  - --enable-hwaccel=h264_vaapi 
  - --enable-hwaccel=mpeg4_vaapi 
  - --enable-hwaccel=h263_vaapi 
  - --enable-hwaccel=vp8_vaapi 
  - --enable-hwaccel=mjpeg_vaapi 
  - --enable-hwaccel=hevc_vaapi 
  - --enable-encoder=h264_vaapi 
  - --enable-encoder=vp8_vaapi 
  - --enable-encoder=mjpeg_vaapi 
  - --enable-encoder=hevc_vaapi
  # Extras
  - --disable-doc
  - --disable-htmlpages
  - --disable-manpages
  - --disable-podpages
  - --disable-txtpages

sources:
  - type: archive
    url: https://github.com/FFmpeg/FFmpeg/archive/refs/tags/n6.0.1.tar.gz
    sha256: 98cb563487d6a652067bfb12a4b4f7fb533fc93e278f6a1821008c0b864c387f
  - type: patch
    path: ../patches/ffmpeg-patches/screen-sharing-x11-fix.patch
  - type: patch
    path: ../patches/ffmpeg-patches/pipewiregrab-source-filter.patch
  - type: patch
    path: ../patches/ffmpeg-patches/libopusenc-reload-packet-loss-at-encode.patch
  - type: patch
    path: ../patches/ffmpeg-patches/remove-mjpeg-log.patch
  - type: patch
    path: ../patches/ffmpeg-patches/change-RTCP-ratio.patch
  - type: patch
    path: ../patches/ffmpeg-patches/rtp_ext_abs_send_time.patch
build-options:
  arch:
    x86_64:
      config-opts:
        - --enable-cuvid 
        - --enable-ffnvcodec 
        - --enable-nvdec 
        - --enable-nvenc 
        - --enable-hwaccel=h264_nvdec 
        - --enable-hwaccel=hevc_nvdec 
        - --enable-hwaccel=vp8_nvdec 
        - --enable-hwaccel=mjpeg_nvdec 
        - --enable-encoder=h264_nvenc 
        - --enable-encoder=hevc_nvenc
        - --arch=x86_64
    aarch64:
      config-opts:
        - --arch=aarch64

