name: jami-daemon
buildsystem: simple
build-commands:
  # build debs
  - mkdir contrib/native
  - autoreconf -fvi
  - cp pjproject-2.10.tar.gz contrib/tarballs
  - cd contrib/native && ../bootstrap --prefix=/app --disable-downloads --disable-all --enable-pjproject
  - cd contrib/native && make DEPS_pjproject=
  # build jamid (meson doesn't install /share/dbus-1/interfaces)
  #- mkdir build
  #- meson --prefix=/app ./ ./build
  #- ninja -C ./build
  #- meson install -C build
  - ./configure --prefix=/app
  - make -j${FLATPAK_BUILDER_N_JOBS}
  - make install
sources:
  - type: git
    url: https://git.jami.net/savoirfairelinux/ring-daemon.git
    commit: 7286e6cb04906d46c00f7829d74f057d828f102f
  - type: file
    url: https://github.com/pjsip/pjproject/archive/2.10/pjproject-2.10.tar.gz
    sha256: 936a4c5b98601b52325463a397ddf11ab4106c6a7b04f8dc7cdd377efbb597de
  - type: patch
    path: ../patches/jami-daemon_no-udev.patch
  - type: patch
    path: ../patches/jami-daemon_fix-no-udev.patch
